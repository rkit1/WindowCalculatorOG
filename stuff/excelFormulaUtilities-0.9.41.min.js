(function(){"undefined"===typeof window&&(window=root);window.excelFormulaUtilities=window.excelFormulaUtilities||{};var t=window.excelFormulaUtilities.core={};window.excelFormulaUtilities.string=window.excelFormulaUtilities.string||{};window.excelFormulaUtilities.string.formatStr=function(j){for(var n=j,k=1;k<arguments.length;k++)n=n.replace(RegExp("\\{{1}"+(k-1).toString()+"{1}\\}{1}","g"),arguments[k]);return n};window.excelFormulaUtilities.string.trim=function(j){return j.replace(/^\s|\s$/,"")};
window.excelFormulaUtilities.string.trim=function(j){return j.replace(/^(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*|(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*$/,"")};var w=t.isFunction=function(j){return"function"===typeof j},A=t.isArray=function(j){return"object"===typeof j&&j.length},x=t.isWindow=function(){return obj&&"object"===typeof obj&&"setInterval"in obj},y=t.isPlainObject=function(j){if(!j||("object"!==typeof j||j.nodeType||x(j))||j.constructor&&!hasOwnProperty.call(j,"constructor")&&!hasOwnProperty.call(j.constructor.prototype,
"isPrototypeOf"))return!1;for(var n in j);return void 0===n||hasOwnProperty.call(j,n)};t.extend=function(){var j,n,k,q,l,o=arguments[0]||{},i=1,v=arguments.length,m=!1;"boolean"===typeof o&&(m=o,o=arguments[1]||{},i=2);"object"!==typeof o&&!w(o)&&(o={});v===i&&(o=this,--i);for(;i<v;i++)if(null!=(j=arguments[i]))for(n in j)k=o[n],q=j[n],o!==q&&(m&&q&&(y(q)||(l=A(q)))?(l?(l=!1,k=k&&A(k)?k:[]):k=k&&y(k)?k:{},o[n]=t.extend(m,k,q)):void 0!==q&&(o[n]=q));return o}})();(function(){function t(e,c,b){this.value=e;this.type=c;this.subtype=b}function w(){this.items=[];this.add=function(e,c,b){b||(b="");e=new t(e,c,b);this.addRef(e);return e};this.addRef=function(e){this.items.push(e)};this.index=-1;this.reset=function(){this.index=-1};this.BOF=function(){return 0>=this.index};this.EOF=function(){return this.index>=this.items.length-1};this.moveNext=function(){if(this.EOF())return!1;this.index+=1;return!0};this.current=function(){return-1===this.index?null:this.items[this.index]};
this.next=function(){return this.EOF()?null:this.items[this.index+1]};this.previous=function(){return 1>this.index?null:this.items[this.index-1]}}function A(){this.items=[];this.push=function(e){this.items.push(e)};this.pop=function(e){var c=this.items.pop();return new t(e||"",c.type,r)};this.token=function(){return 0<this.items.length?this.items[this.items.length-1]:null};this.value=function(){return this.token()?this.token().value.toString():""};this.type=function(){return this.token()?this.token().type.toString():
""};this.subtype=function(){return this.token()?this.token().subtype.toString():""}}function x(e){for(var c=new w,b=new A,d=0,f=function(){return e.substr(d,1)},a="",h=!1,g=!1,i=!1,j=!1,k=/^[1-9]{1}(\.[0-9]+)?E{1}$/;0<e.length;)if(" "===e.substr(0,1))e=e.substr(1);else{"="===e.substr(0,1)&&(e=e.substr(1));break}for(;!(d>=e.length);)if(h)'"'===f()?'"'===e.substr(d+1,1)?(a+='"',d+=1):(h=!1,c.add(a,m,K),a=""):a+=f(),d+=1;else if(g)"'"===f()?"'"===e.substr(d+1,1)?(a+="'",d+=1):g=!1:a+=f(),d+=1;else if(i)"]"===
f()&&(i=!1),a+=f(),d+=1;else if(j)a+=f(),d+=1,-1!==",#NULL!,#DIV/0!,#VALUE!,#REF!,#NAME?,#NUM!,#N/A,".indexOf(","+a+",")&&(j=!1,c.add(a,m,L),a="");else if(-1!=="+-".indexOf(f())&&1<a.length&&a.match(k))a+=f(),d+=1;else if('"'===f())0<a.length&&(c.add(a,B),a=""),h=!0,d+=1;else if("'"===f())0<a.length&&(c.add(a,B),a=""),g=!0,d+=1;else if("["===f())i=!0,a+=f(),d+=1;else if("#"===f())0<a.length&&(c.add(a,B),a=""),j=!0,a+=f(),d+=1;else if("{"===f())0<a.length&&(c.add(a,B),a=""),b.push(c.add("ARRAY",p,
s)),b.push(c.add("ARRAYROW",p,s)),d+=1;else if(";"===f())0<a.length&&(c.add(a,m),a=""),c.addRef(b.pop()),c.add(",",C),b.push(c.add("ARRAYROW",p,s)),d+=1;else if("}"===f())0<a.length&&(c.add(a,m),a=""),c.addRef(b.pop("ARRAYROWSTOP")),c.addRef(b.pop("ARRAYSTOP")),d+=1;else if(" "===f()){0<a.length&&(c.add(a,m),a="");c.add("",G);for(d+=1;" "===f()&&!(d>=e.length);)d+=1}else-1!==",>=,<=,<>,".indexOf(","+e.substr(d,2)+",")?(0<a.length&&(c.add(a,m),a=""),c.add(e.substr(d,2),u,D),d+=2):(-1!=="+-*/^&=><".indexOf(f())?
(0<a.length&&(c.add(a,m),a=""),c.add(f(),u)):-1!=="%".indexOf(f())?(0<a.length&&(c.add(a,m),a=""),c.add(f(),E)):"("===f()?0<a.length?(b.push(c.add(a,p,s)),a=""):b.push(c.add("",z,s)):","===f()?(0<a.length&&(c.add(a,m),a=""),b.type()!==p?c.add(f(),u,M):c.add(f(),C)):")"===f()?(0<a.length&&(c.add(a,m),a=""),c.addRef(b.pop())):a+=f(),d+=1);0<a.length&&c.add(a,m);for(b=new w;c.moveNext();)a=c.current(),a.type.toString()===G?(f=(f=(f=c.BOF()||c.EOF())&&(c.previous().type.toString()===p&&c.previous().subtype.toString()===
r||c.previous().type.toString()===z&&c.previous().subtype.toString()===r||c.previous().type.toString()===m))&&(c.next().type.toString()===p&&c.next().subtype.toString()===s||c.next().type.toString()===z&&c.next().subtype.toString()===s||c.next().type.toString()===m))&&b.add(a.value.toString(),u,N):b.addRef(a);for(;b.moveNext();)a=b.current(),a.type.toString()===u&&"-"===a.value.toString()?b.BOF()?a.type=H.toString():b.previous().type.toString()===p&&b.previous().subtype.toString()===r||b.previous().type.toString()===
z&&b.previous().subtype.toString()===r||b.previous().type.toString()===E||b.previous().type.toString()===m?a.subtype=F.toString():a.type=H.toString():a.type.toString()===u&&"+"===a.value.toString()?b.BOF()?a.type=v.toString():b.previous().type.toString()===p&&b.previous().subtype.toString()===r||b.previous().type.toString()===z&&b.previous().subtype.toString()===r||b.previous().type.toString()===E||b.previous().type.toString()===m?a.subtype=F.toString():a.type=v.toString():a.type.toString()===u&&
0===a.subtype.length?a.subtype=-1!=="<>=".indexOf(a.value.substr(0,1))?D.toString():"&"===a.value.toString()?O.toString():F.toString():a.type.toString()===m&&0===a.subtype.length?a.subtype=isNaN(parseFloat(a.value))?"TRUE"===a.value.toString()||"FALSE"===a.value.toString()?D.toString():I.toString():P.toString():a.type.toString()===p&&"@"===a.value.substr(0,1)&&(a.value=a.value.substr(1).toString());b.reset();for(c=new w;b.moveNext();)b.current().type.toString()!==v&&c.addRef(b.current());c.reset();
return c}function y(e,c){if(!RegExp("[a-z]+[0-9]+:[a-z]+[0-9]+","gi").test(e))throw"This is not a valid range: "+e;for(var b=e.split(":"),d=b[0].match(/[0-9]+/gi)[0],f=b[0].match(/[A-Z]+/gi)[0],a=b[1].match(/[0-9]+/gi)[0],b=b[1].match(/[A-Z]+/gi)[0],d=a-d+1,f=j(b)-j(f)+1,a=0,b=1,h="",g="";b<=d;b+=1){for(;a<f;a+=1){var h=a,h=Math.abs(h),i="",k=!1,m=void 0;do m=h%26,k&&25>h&&m--,i=String.fromCharCode(m+65)+i,h=Math.floor((h-m)/26),k=!0;while(0<h);h=i+b;g+=h+(b===d&&a===f-1?"":c)}a=0}return g}function j(e){var e=
e.toUpperCase(),c=0,b=1;if(null!==e&&"undefined"!==typeof e&&0<e.length)for(c=e.charCodeAt(0)-65;b<e.length;b++)c=0===c?26:26*c,c+=e.charCodeAt(b)-65;return c}function n(e,c,b,d,f,a){var a=void 0===typeof a||null===a?null:a,h=function(a){return a.replace(/\{\{token\}\}/gi,"{0}").replace(/\{\{autoindent\}\}/gi,"{1}").replace(/\{\{autolinebreak\}\}/gi,"{2}")},g="",g="text"===e.subtype||"text"===e.type?e.value.toString():(0===e.value.length?" ":e.value.toString()).split(" ").join("").toString();if("function"===
typeof f&&(f=f(g,e,b,d),g=f.tokenString,!f.useTemplate))return g;switch(e.type){case "function":switch(e.value){case "ARRAY":g=l(h(c.tmplFunctionStartArray),g,b,d);break;case "ARRAYROW":g=l(h(c.tmplFunctionStartArrayRow),g,b,d);break;default:g="start"===e.subtype.toString()?l(h(c.tmplFunctionStart),g,b,d):l(h(c.tmplFunctionStop),g,b,d)}break;case "operand":switch(e.subtype.toString()){case "error":g=l(h(c.tmplOperandError),g,b,d);break;case "range":g=l(h(c.tmplOperandRange),g,b,d);break;case "number":g=
l(h(c.tmplOperandNumber),g,b,d);break;case "text":g=l(h(c.tmplOperandText),g,b,d);break;case "argument":g=l(h(c.tmplArgument),g,b,d)}break;case "operator-infix":case "logical":g=l(h(c.tmplOperandLogical),g,b,d);break;case "argument":g="argument"!==a.type?l(h(c.tmplArgument),g,b,d):l(h("{{autoindent}}"+c.tmplArgument),g,b,d);break;case "subexpression":g="start"===e.subtype.toString()?l(h(c.tmplSubexpressionStart),g,b,d):l(h(c.tmplSubexpressionStop),g,b,d)}return g}"undefined"===typeof window&&(window=
root);var k=window.excelFormulaUtilities=window.excelFormulaUtilities||{},q=window.excelFormulaUtilities.core,l=window.excelFormulaUtilities.string.formatStr,o=window.excelFormulaUtilities.string.trim,i={},v=i.TOK_TYPE_NOOP="noop",m=i.TOK_TYPE_OPERAND="operand",p=i.TOK_TYPE_FUNCTION="function",z=i.TOK_TYPE_SUBEXPR="subexpression",C=i.TOK_TYPE_ARGUMENT="argument",H=i.TOK_TYPE_OP_PRE="operator-prefix",u=i.TOK_TYPE_OP_IN="operator-infix",E=i.TOK_TYPE_OP_POST="operator-postfix",G=i.TOK_TYPE_WSPACE="white-space",
B=i.TOK_TYPE_UNKNOWN="unknown",s=i.TOK_SUBTYPE_START="start",r=i.TOK_SUBTYPE_STOP="stop",K=i.TOK_SUBTYPE_TEXT="text",P=i.TOK_SUBTYPE_NUMBER="number",D=i.TOK_SUBTYPE_LOGICAL="logical",L=i.TOK_SUBTYPE_ERROR="error",I=i.TOK_SUBTYPE_RANGE="range",F=i.TOK_SUBTYPE_MATH="math",O=i.TOK_SUBTYPE_CONCAT="concatenate",N=i.TOK_SUBTYPE_INTERSECT="intersect",M=i.TOK_SUBTYPE_UNION="union";k.parseFormula=function(e,c){var b=0,d=document.getElementById(e),f=x(d.value),a;for(a="<table cellspacing='0' style='border-top: 1px #cecece solid; margin-top: 5px; margin-bottom: 5px'><tr><td class='token' style='font-weight: bold; width: 50px'>index</td><td class='token' style='font-weight: bold; width: 125px'>type</td><td class='token' style='font-weight: bold; width: 125px'>subtype</td><td class='token' style='font-weight: bold; width: 150px'>token</td><td class='token' style='font-weight: bold; width: 300px'>token tree</td></tr>";f.moveNext();){var h=
f.current();h.subtype===r&&(b-=0<b?1:0);a+="<tr>";a+="<td class='token'>"+(f.index+1)+"</td>";a+="<td class='token'>"+h.type+"</td>";a+="<td class='token'>"+(0===h.subtype.length?"&nbsp;":h.subtype.toString())+"</td>";a+="<td class='token'>"+(0===h.value.length?"&nbsp;":h.value).split(" ").join("&nbsp;")+"</td>";for(var g="|",i=0;i<b;i+=1)g+="&nbsp;&nbsp;&nbsp;|";a+="<td class='token'>"+g+(0===h.value.length?"&nbsp;":h.value).split(" ").join("&nbsp;")+"</td>";a+="</tr>";h.subtype===s&&(b+=1)}document.getElementById(c).innerHTML=
a+"</table>";d.select();d.focus()};var J=k.formatFormula=function(e,c){for(var e=e.replace(/^\s*=\s+/gi,"="),b={tmplFunctionStart:"{{autoindent}}{{token}}(\n",tmplFunctionStop:"\n{{autoindent}}{{token}})",tmplOperandError:" {{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}"{{token}}"',tmplArgument:"{{token}}\n",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",
tmplFunctionStopArray:"",tmplSubexpressionStart:"{{autoindent}}(\n",tmplSubexpressionStop:"\n)",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",newLine:"\n",customTokenRender:null,prefix:"",postfix:""},c=c?q.extend(!0,b,c):b,b=0,d=x(e),f="",a=c.autoLineBreak.replace(/\s/gi,"").split("|"),h=!0,g=null;d.moveNext();){var j=d.current(),k=d.next();j.subtype.toString()===r&&(b-=0<b?1:0);var m=RegExp(c.newLine+"$","");a:{for(var l=
0;l<a.length;l+=1)if(null!==k&&"undefined"!==typeof k&&(i[a[l]]===k.type.toString()||i[a[l]]===k.subtype.toString())){k=!0;break a}k=!1}if(h){h="";for(l=0;l<b;l+=1)h+=c.tmplIndentTab}else h=c.tmplIndentSpace;f+=n(j,c,h,k?c.newLine:"",c.customTokenRender,g);j.subtype.toString()===s&&(b+=1);h=k||m.test(f);g=j}return f=c.prefix+o(f)+c.postfix};k.formatFormulaHTML=function(e){return J(e,{tmplFunctionStart:'{{autoindent}}<span class="function">{{token}}</span><span class="function_start">(</span><br />',
tmplFunctionStop:'<br />{{autoindent}}{{token}}<span class="function_stop">)</span>',tmplOperandError:"{{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}<span class="quote_mark">"</span><span class="text">{{token}}</span><span class="quote_mark">"</span>',tmplArgument:"{{token}}<br />",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",
tmplSubexpressionStart:"{{autoindent}}(",tmplSubexpressionStop:" )",tmplIndentTab:'<span class="tabbed">&nbsp;&nbsp;&nbsp;&nbsp;</span>',tmplIndentSpace:"&nbsp;",newLine:"<br />",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",trim:!0,prefix:"=",customTokenRender:null})};var Q=k.formula2CSharp=function(e){var c=[];return J(e,{tmplFunctionStart:"{{token}}(",tmplFunctionStop:"{{token}})",tmplOperandError:"{{token}}",tmplOperandRange:"{{token}}",tmplOperandLogical:"{{token}}",
tmplOperandNumber:"{{token}}",tmplOperandText:'"{{token}}"',tmplArgument:"{{token}}",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"(",tmplSubexpressionStop:")",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_SUBTYPE_STOP | TOK_SUBTYPE_START | TOK_TYPE_ARGUMENT",trim:!0,customTokenRender:function(b,d){var f="",a={"=":"==","<>":"!=",MIN:"Math.Min",MAX:"Math.Max",ABS:"Math.ABS",SUM:"",IF:"","&":"+"},e=c[c.length-
1],g=!1;switch(d.type.toString()){case p:switch(d.subtype){case s:c.push({name:b,argumentNumber:0});f="string"===typeof a[b.toUpperCase()]?a[b.toUpperCase()]:b;g=!0;break;case r:g=!0;switch(e.name.toLowerCase()){case "if":f=")";g=!1;break;default:f="string"===typeof a[b.toUpperCase()]?a[b.toUpperCase()]:b}c.pop()}break;case C:switch(e.name.toLowerCase()){case "if":switch(e.argumentNumber){case 0:f="?";break;case 1:f=":"}break;case "sum":f="+";break;default:f="string"===typeof a[b.toUpperCase()]?a[b.toUpperCase()]:
b,g=!0}e.argumentNumber+=1;break;case m:switch(d.subtype){case I:switch(e.name.toLowerCase()){case "sum":RegExp(":","gi").test(b)?f=y(b,"+"):outStr=b;break;default:f=RegExp(":","gi").test(b)?"["+y(b,",")+"]":b}break}default:""===f&&(f="string"===typeof a[b.toUpperCase()]?a[b.toUpperCase()]:b),g=!0}return{tokenString:f,useTemplate:g}}})};k.formula2JavaScript=function(e){return Q(e).replace("==","===")};k.getTokens=x})();
